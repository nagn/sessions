<script type="text/javascript">
    $(function() {
    // Below is the name of the textfield that will be autocomplete
      function split( val ) {
        return val.split( /,\s*/ );
      }
      function extractLast( term ) {
        return split( term ).pop();
      }
      
      $('#search_student').autocomplete({
        //This shows the min length of charcters that must be typed before the autocomplete looks for a match.
        minLength: 2,
        position: { my : "left bottom", at: "left top" },
        //This is the source of the auocomplete suggestions. In this case a list of names from the people controller, in JSON format.
        source: function( request, response ) {
        $.getJSON('<%= students_path(:json) %>', {
          term: extractLast( request.term ),
          session_id: <%= @session.id%>
          }, response );
        },
        
        search: function() {
          // custom minLength
          var term = extractLast( this.value );
          if ( term.length < 2 ) {
            return false;
          }
        },
        //This updates the textfield when you move the updown the suggestions list, with your keyboard.
        //In our case it will reflect the same value that you see in the
        //suggestions which is the student.name.
        focus: function() {
          return false;
        },
        //Once a value in the drop down list is selected, do the following:
        select: function(event, ui) {
          var user_id = ui.item.id;
          var session_path = "<%=add_student_session_path%>";
          $.ajax({
            type: "POST",
            url: session_path,
            data: {
              selected_student: user_id
            },
            headers: {
              'X-CSRF-Token': '<%= form_authenticity_token.to_s %>'
            },
            success: function(msg) {
              //alert( "Added student status: " + msg );
            }
          });
          var terms = split( this.value );
          terms.pop();
          // add the selected item
          terms.push( ui.item.name );
          // add placeholder to get the comma-and-space at the end
          terms.push( "" );
          this.value = terms.join( ", " );
          
          return false;
        }
      }).data("uiAutocomplete")._renderItem = function( ul, item ) {
            return $( "<li></li>" )
            .data( "item.autocomplete", item )
              // For now which just want to show the person.given_name in the list.
                .append( "<a>" + item.name + "</a>" )
                .appendTo( ul );
        };
  });
</script>